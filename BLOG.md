# Remix + Cloudflare Fullstack example with Github Markdown

ì•ˆë…•í•˜ì„¸ìš”?

í’€ìŠ¤íƒ ê°•ì¢Œë¥¼ ì˜¤ëœë§Œì— í•˜ë‚˜ í•˜ê²Œ ëë„¤ìš”.

ìµœê·¼ì— Remix ìª½ì— ê´œì°®ì€ í…œí”Œë¦¿ì´ í•˜ë‚˜ ë‚˜ì™”ëŠ”ë°ìš”.

edmundhungì´ë€ í™ì½©ë¶„ì´ì‹ ë°ìš”.

conformì´ë€ validation ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë§Œë“  ë¶„ì¸ë°ìš”.

Remixìª½ì— ê´€ì‹¬ì´ ë§ì€ ê±° ê°™ìŠµë‹ˆë‹¤.

ì‚¬ì‹¤ Reactë¡œ í’€ìŠ¤íƒì„ ì•„ì£¼ ì‰½ê²Œ êµ¬í˜„í•´ ì£¼ëŠ”ê²Œ Remix ë°–ì— ì—†ì£ .

ì´ Remixë¥¼ Cloudflareì™€ ì—°ê²°ì‹œí‚¤ë ¤ëŠ” ì‹œë„ê°€ ì•„ì£¼ ë§ì€ë°ìš”.

`Edmund Hung` ì´ ë¶„ë„ ìƒˆë¡œìš´ ê±¸ í•˜ë‚˜ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

[remix-cloudflare-template](https://github.com/edmundhung/remix-cloudflare-template)

ìœ„ ë§í¬ë¡œ ê°€ì‹œë©´ Github ë¦¬í¬ì— ê°ˆ ìˆ˜ ìˆëŠ”ë°ìš”.

All-in-one remix starter template for Cloudflare Pagesë¼ê³  í•©ë‹ˆë‹¤.

ì œê°€ ì´ê±¸ ëŒ€ì¶© ì‚´í´ë³´ë‹ˆê¹Œ ê¸°ë³¸ì ìœ¼ë¡œ Github APIë¥¼ ì´ìš©í•´ì„œ ì›í•˜ëŠ” ë§ˆí¬ë‹¤ìš´ íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ê³ , í•´ë‹¹ ë§ˆí¬ë‹¤ìš´ íŒŒì¼ì„ Markdocì´ë€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ íŒŒì‹±í•´ì„œ íŒŒì‹±í•œ ì •ë³´ë¥¼ Cloudflare KVì— ì˜¬ë¦½ë‹ˆë‹¤.

KVì— putí•  ë•Œ ìºì‹œ ì‹œê°„ì„ 60ë¶„ìœ¼ë¡œ ë‘¡ë‹ˆë‹¤.

ê·¸ë˜ì„œ 60ë¶„ ì´ë‚´ ê°™ì€ ë¼ìš°íŒ…ìœ¼ë¡œ GET ë¦¬í€˜ìŠ¤íŠ¸ê°€ ì˜¤ë©´ CloudflareëŠ” ìºì‹œëœ ê°’ì„ ë¹¨ë¦¬ ë³´ì—¬ì¤„ ìˆ˜ ìˆì£ .

ê·¸ë¦¬ê³  Remixì˜ ì„œë²„ëŠ” Cloudflare Pagesì—ì„œ Functions ë°©ì‹ìœ¼ë¡œ ëŒì•„ê°€ê²Œ ë©ë‹ˆë‹¤.

ì˜ˆì „ì— Remixì™€ Cloudflare ê·¸ë¦¬ê³  D1 ê°•ì¢Œë¥¼ ì˜¬ë ¸ì„ ë•Œë„ ê°™ì€ ê±´ë°ìš”.

ì œê°€ ì´ í…œí”Œë¦¿ì„ ë³´ê³  ê¸°ìœ ì ì€ ë°”ë¡œ ì œ ë¸”ë¡œê·¸ê°€ ì‚¬ì‹¤ ì´ ë°©ì‹ìœ¼ë¡œ ì‘ì„±ëë‹¤ëŠ” ê²ë‹ˆë‹¤.

ì œ ë¸”ë¡œê·¸ëŠ” Fly.ioì— íŒŒì‹±ëœ ë§ˆí¬ë‹¤ìš´ ì •ë³´ê°€ Sqliteì— ì €ì¥ë˜ê³  Remix ì„œë²„ëŠ” fly.devì—ì„œ ìš´ì˜ë˜ëŠ” í˜•ì‹ì¸ë°, Githubì— ë§ˆí¬ë‹¤ìš´ íŒŒì¼ì„ ì˜¬ë¦¬ë©´ ì•Œì•„ì„œ ìƒˆë¡œìš´ ë§ˆí¬ë‹¤ìš´ íŒŒì¼ë§Œ íŒŒì‹±í•´ì„œ Fly.ioì˜ sqliteì— ì €ì¥ì‹œì¼œì£¼ëŠ” í˜•ì‹ì…ë‹ˆë‹¤.

ì˜ˆì „ì— ë¸”ë¡œê·¸ì—ì„œ ì œ ë¸”ë¡œê·¸ ê´€ë ¨ ê¸€ì„ ì“´ì ì´ ìˆìŠµë‹ˆë‹¤.

Remix-Cloudflare-Templateë¥¼ ì¡°ê¸ˆ ë” ë°œì „ ì‹œí‚¤ë©´ ì œ ë¸”ë¡œê·¸ í˜•ì‹ì„ Cloudflareì— ì ìš©ì‹œí‚¬ ìˆ˜ ìˆì„ ê±° ê°™ë„¤ìš”.

ê·¸ ë•Œ ê°€ì„œëŠ” KV ë§ê³  D1 ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì´ìš©í•˜ë©´ ë˜êµ¬ìš”.

ì, ì´ì œ í•œë²ˆ ì´ í…œí”Œë¦¿ì„ í…ŒìŠ¤íŠ¸í•´ ë³´ê² ìŠµë‹ˆë‹¤.

---

## ì„¤ì¹˜

```bash
âœ  npx create-remix@latest --template edmundhung/remix-cloudflare-template

 remix   v2.7.2 ğŸ’¿ Let's build a better website...

   dir   Where should we create your new project?
         ./remix-cloudflare-template

      â—¼  Template: Using edmundhung/remix-cloudflare-template...
      âœ”  Template copied

   git   Initialize a new git repository?
         Yes

  deps   Install dependencies with npm?
         Yes

      âœ”  Dependencies installed

      âœ”  Git initialized

  done   That's it!

         Enter your project directory using cd ./remix-cloudflare-template
         Check out README.md for development and deploy instructions.

         Join the community at https://rmx.as/discord

âœ  cd remix-cloudflare-template
```

ì •í™•íˆ `edmundhung` ì´ ë¶„ì˜ í…œí”Œë¦¿ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

README íŒŒì¼ì„ ë³´ë©´ ë§¨ ë¨¼ì €, wrangler.toml íŒŒì¼ì„ ì„¤ì •í•˜ë¼ê³  í•©ë‹ˆë‹¤.

```bash
cp wrangler.toml.example wrangler.toml
```

wrangler.toml íŒŒì¼ì„ ë³´ì‹œë©´ ì•„ë˜ì™€ ê°™ì´ ë‚˜ì˜µë‹ˆë‹¤.

ìš°ë¦¬ê°€ ì‚¬ìš©í•  kv_namespaceì™€ varsê°€ ìˆì£ .

varsëŠ” `.env` íŒŒì¼ì— ë„£ì–´ë‘ëŠ” ê·¹ë¹„ ìë£Œì™€ ê°™ì€ ê²ë‹ˆë‹¤.

wrangler.toml íŒŒì¼ì€ `.gitignore`ì— ë“¤ì–´ê°€ ìˆì–´ì„œ githubì— ìœ ì¶œ ë  ì¼ì´ ì—†ìœ¼ë‹ˆ ê±±ì •í•˜ì§€ ë§ˆì‹­ì‹œìš”.

```bash
name = "remix-cloudflare-template"
compatibility_date = "2024-02-11"
kv_namespaces = [
  { binding = "cache", id = "cache" }
]

[vars]
GITHUB_TOKEN = ""
```

ê·¸ë¦¬ê³  kv_namespacesì— ë³´ì‹œë©´ bindingì´ë€ê²Œ ë³´ì´ëŠ”ë°ìš”.

ì´ bindingì´ ë°”ë¡œ ìš°ë¦¬ê°€ ì½”ë“œì—ì„œ ì‚¬ìš©í•  ë°”ì¸ë”© ê°’ì…ë‹ˆë‹¤.

ê·¸ë¦¬ê³  idëŠ” ì‹¤ì œ kv_namespacesë¥¼ ë§Œë“¤ë©´ cloudflareê°€ ì œê³µí•´ ì£¼ëŠ” ìœ ë‹ˆí¬í•œ idì…ë‹ˆë‹¤.

ì´ í…œí”Œë¦¿ì€ ë°”ì¸ë”© ì´ë¦„ìœ¼ë¡œ `cache`ë¼ëŠ” ì´ë¦„ì„ ì“°ê³  ìˆìœ¼ë‹ˆê¹Œ ì´ ì´ë¦„ì€ ë°”ê¾¸ì§€ ë§ˆì‹­ì‹œìš”.

ê·¸ë¦¬ê³  `remix-cloudflare-template`ë¼ê³  ë˜ì–´ ìˆëŠ” `name` ë¶€ë¶„ì€ ë°”ê¿”ë„ ë©ë‹ˆë‹¤.

READMEíŒŒì¼ì—ì„œ ì–˜ê¸°í•˜ëŠ” ë‘ ë²ˆì§¸ë¡œ ì‹¤í–‰í•  ëª…ë ¹ì–´ëŠ” ê°œë°œ ì„œë²„ë¥¼ ëŒë¦¬ëŠ” ê±´ë°ìš”.

```bash
npm run dev
```

ì‹¤í–‰í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ ì—ëŸ¬ê°€ ë‚  ê²ë‹ˆë‹¤.

```bash
> dev
> remix vite:dev

failed to load config from /Users/cpro95/Codings/Javascript/remix-test/remix-cloudflare-template/vite.config.ts
file:///Users/cpro95/Codings/Javascript/remix-test/remix-cloudflare-template/vite.config.ts.timestamp-1708846182387-585dec7ad60ea.mjs:4
  unstable_cloudflarePreset as cloudflare
  ^^^^^^^^^^^^^^^^^^^^^^^^^
SyntaxError: Named export 'unstable_cloudflarePreset' not found. The requested module 'file:///Users/cpro95/Codings/Javascript/remix-test/remix-cloudflare-template/node_modules/@remix-run/dev/dist/index.js' is a CommonJS module, which may not support all module.exports as named exports.
CommonJS modules can always be imported via the default export, for example using:

import pkg from 'file:///Users/cpro95/Codings/Javascript/remix-test/remix-cloudflare-template/node_modules/@remix-run/dev/dist/index.js';

    at ModuleJob._instantiate (node:internal/modules/esm/module_job:124:21)
    at async ModuleJob.run (node:internal/modules/esm/module_job:190:5)
```

ì´ ì—ëŸ¬ëŠ” ë‹¤ë¦„ ì•„ë‹ˆë¼ Remixë„ ë²ˆë“¤ëŸ¬ë¥¼ Viteë¡œ ê°œí¸ì¤‘ì¸ë°ìš”.

ì•„ì§ Viteë¥¼ ì´ìš©í•œ ì •ì‹ ë²„ì „ì´ ì•ˆ ë‚˜ì™€ì„œ ê·¸ëŸ°ê²ë‹ˆë‹¤.

ì´ì œ vite.config.ts íŒŒì¼ì„ ì—´ì–´ ì•„ë˜ì™€ ê°™ì´ ë°”ê¿” ì£¼ë©´ ë©ë‹ˆë‹¤.

ê³µì‹ Remix í™ˆí˜ì´ì§€ì—ì„œ ì •ë³´ë¥¼ ì–»ì€ ê²ë‹ˆë‹¤.

```ts
import {
        vitePlugin as remix,
        cloudflareDevProxyVitePlugin as remixCloudflareDevProxy,
} from '@remix-run/dev';
import { defineConfig } from 'vite';
import tsconfigPaths from 'vite-tsconfig-paths';

export default defineConfig({
        plugins: [
            remixCloudflareDevProxy(),
            remix(),
            tsconfigPaths()
        ],
        ssr: {
                resolve: {
                        externalConditions: ['workerd', 'worker'],
                },
        },
});
```

ì´ì œ ë‹¤ì‹œ `npm run dev`ë¡œ ê°œë°œì„œë²„ë¥¼ ëŒë ¤ë³¼ê¹Œìš”?

í¬íŠ¸ 5173ìœ¼ë¡œ ë“¤ì–´ê°€ ë³´ë©´ ë¦¬ë¯¹ìŠ¤ ì„œë²„ëŠ” ì˜ ëŒì•„ê°€ëŠ”ë°ìš”.

ì¤‘ê°„ì— `cache` ë¶€ë¶„ì´ ì—ëŸ¬ë¼ê³  ë‚˜ì˜µë‹ˆë‹¤.

ì¦‰, Cloudflareì˜ KV Namespace ê´€ë ¨ì¸ê±° ê°™ë„¤ìš”.

README íŒŒì¼ì„ ê³„ì† ì½ì–´ê°€ë©´ í…ŒìŠ¤íŠ¸ ë¶€ë¶„ì´ ë‚˜ì˜¤ê³  ê·¸ ë‹¤ìŒì— wranglerë¥¼ ì´ìš©í•œ ê°œë°œ ì„œë²„ë¥¼ ëŒë¦¬ëŠ” ë¶€ë¶„ì´ ë°”ë¡œ ë‹¤ìŒì— ë‚˜ì˜¤ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤.

```bash
npm run build && npm run start
```

ì¦‰, ë¹Œë“œ í•œë²ˆí•˜ê³  start ì‹œí‚¤ë„¤ìš”.

startëŠ” ì•„ë˜ ë¶€ë¶„ì…ë‹ˆë‹¤. 

```json
"start": "wrangler pages dev ./build/client",
```

`wrangler pages dev` ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ë„¤ìš”.

ì´ ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ë©´ Cloudflare ê´€ë ¨ KV ë¼ë˜ê°€ D1 ë¶€ë¶„ì„ ë¡œì»¬ì—ì„œ ë¯¸ë¯¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ì œ ì‹¤í–‰í•´ ë³¼ê¹Œìš”?

```bash
âœ¨ Compiled Worker successfully
 â›…ï¸ wrangler 3.29.0
-------------------
Your worker has access to the following bindings:
- KV Namespaces:
  - cache: cache
- Vars:
  - GITHUB_TOKEN: ""
[wrangler:inf] Ready on http://localhost:8788
â” Starting local server...
Parsed 1 valid header rule.
[wrangler:inf] GET / 200 OK (392ms)
```

ìœ„ì™€ ê°™ì´ ë‚˜ì˜¤ë©´ì„œ ë¸Œë¼ìš°ì €ë¥¼ 'b' ë²„íŠ¼ì„ ëˆŒëŸ¬ ë¶ˆëŸ¬ë³´ë©´ ë¸Œë¼ìš°ì €ì— ë­”ê°€ í¬ê²Œ ë‚˜ì˜µë‹ˆë‹¤.

README.md íŒŒì¼ì„ ë§ˆí¬ë‹¤ìš´ íŒŒì‹±í•´ì„œ ë¸Œë¼ìš°ì €ì— ë¿Œë ¤ì£¼ê³  ìˆë„¤ìš”.

KV ìª½ì„ í•œ ë²ˆ ì‚´í´ë³¼ê¹Œìš”?

`.wrangler` í´ë”ë¡œ ë“¤ì–´ê°€ì‹œë©´ `state/v3` í´ë” ë°‘ì— `kv` í´ë”ê°€ ìˆìŠµë‹ˆë‹¤.

ê±°ê¸° `cache`ë¼ëŠ” ì´ë¦„ì´ ìˆëŠ”ë° ì´ê²Œ ìš°ë¦¬ê°€ ì•„ê¹Œ ë°”ì¸ë”© í–ˆë˜ ê·¸ ì´ë¦„ì…ë‹ˆë‹¤.

ê·¸ë¦¬ê³  `cache` í´ë” ë°‘ì— ì´ìƒí•œ ë¬¸ìì—´ì˜ íŒŒì¼ì´ ìˆëŠ”ë°ìš”.

ì—´ì–´ë³´ì‹œë©´ ê·¸ê²Œ ë°”ë¡œ README.md íŒŒì¼ì…ë‹ˆë‹¤.

ê·¼ë° ì´ìƒí•˜ì£ .

README.md íŒŒì¼ì„ ë¡œì»¬ì—ì„œ ë¶ˆëŸ¬ì˜¨ê²Œ ì•„ë‹Œê±° ê°™ì€ë°, ì–´ë””ì„œ ê°€ì ¸ì™”ì£ .

ì´ í…œí”Œë¦¿ì´ GITHUBìª½ê³¼ ê´€ë ¨ëœ ì„œë²„ì‚¬ì´ë“œ ì½”ë“œëŠ” ëª¨ë‘ `app/services` í´ë”ì— ìˆëŠ” ë‘ê°œì˜ íŒŒì¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.

ê±°ê¸° `github.server.ts` íŒŒì¼ì„ ì½ì–´ ë³´ì‹œë©´,

```ts
export const metadata = {
	repo: 'remix-cloudflare-template',
	owner: 'edmundhung',
};
```

ì½”ë“œ ì´ˆì°½ê¸° ë¶€ë¶„ì— metadataê°€ ìœ„ì™€ ê°™ì´ ìƒìˆ˜ë¡œ ì í˜€ìˆìŠµë‹ˆë‹¤.

ì´ì œì•¼ ì˜ë¬¸ì´ í’€ë¦¬ë„¤ìš”.

ì›ì‘ìì¸ `edmundhung`ë‹˜ì˜ `remix-cloudflare-template` ë¦¬í¬ì—ì„œ README.md íŒŒì¼ì„ ì½ì–´ì˜¤ê³  ìˆë„¤ìš”.

ì´ê±¸ í•œë²ˆ ë°”ê¿”ë³´ì‹­ì‹œìš”.

ë³¸ì¸ì˜ ì•„ë¬´ ë¦¬í¬ì—ì„œ README.mdë¥¼ ê°€ì§€ê³  ì˜¬ ìˆ˜ ìˆê²Œ ë³¸ì¸ ì•„ì´ë””ë‘ ë¦¬í¬ì´ë¦„ë§Œ ë°”ê¾¸ì‹­ì‹œìš”.

ê°œë°œ ì„œë²„ë¥¼ ë‹¤ì‹œ ë„ê³  buildì™€ startë¥¼ ë‹¤ì‹œ í•´ ë³´ì‹­ì‹œìš”.

ê·¸ëŸ°ë° ì•„ë¬´ ë°”ë€ê²Œ ì—†ì„ ê²ë‹ˆë‹¤.

ì™œëƒí•˜ë©´ KVê°€ ìºì‹œëœ ë¶€ë¶„ì„ ê°€ì ¸ì˜¤ê¸° ë•Œë¬¸ì´ì£ .

ì•„ê¹Œ ë´¤ë˜ `.wrangler/state/v3` í´ë”ì—ì„œ cache ëœ íŒŒì¼ì„ ê°•ì œë¡œ ì§€ìš°ê³  ë‹¤ì‹œ ì‹œì‘í•˜ë©´ ë©ë‹ˆë‹¤.

ì´ì œ ì œê°€ ì„ì˜ë¡œ ì§€ì •í•œ ì œ ë¦¬í¬ì˜ README.md íŒŒì¼ì´ ë³´ì´ê²Œ ë˜ëŠ”ë°ìš”.

í•œê¸€ ë¶€ë¶„ì´ ê¹¨ì§‘ë‹ˆë‹¤.

ë¶„ëª…íˆ root.tsx íŒŒì¼ì—ì„œ ìºë¦­í„° ì…‹ë„ 'utf-8'ë¡œ ì„¸íŒ…í–ˆëŠ”ë°, ì´ìƒí•©ë‹ˆë‹¤.

root.tsx íŒŒì¼ì˜ html íƒœê·¸ ë¶€ë¶„ì˜ lang ë¶€ë¶„ë„ 'ko'ë¡œ ë°”ê¿”ë„ í•œê¸€ ë¬¸ì œê°€ í•´ê²°ë˜ì§€ëŠ” ì•Šë„¤ìš”.

![](https://blogger.googleusercontent.com/img/a/AVvXsEh6P5COAowEVRNm6G29ryLJMrrhiG-AtUDfsCX5PHsbMvI1VhDUr9VmNyNxUfKk-vyqcG6a_NqGJT9JhzuR748DMjWpIWBk4quZQ2KciN2Hwh7nVq92ZuJmdTCUL5TjEkKS6t7LZcuOL1qtuHR2HigKPx4tNs5UYlA28i5wYpd3TKcQ3OOOXJIIqkFCg24)

ìœ„ì™€ ê°™ì´ í•œê¸€ì´ ê¹¨ì ¸ë‚˜ì˜µë‹ˆë‹¤.

ì´ ë¶€ë¶„ì€ textDecoder ë¶€ë¶„ìœ¼ë¡œ ë°”ê¿”ì•¼ í•˜ëŠ”ë°ìš”.

`github.server.ts` íŒŒì¼ì—ì„œ ì½ì–´ì˜¤ëŠ” í•¨ìˆ˜ì¸ `getFileContent` í•¨ìˆ˜ì˜ ë§ˆì§€ë§‰ ë¶€ë¶„ì¸ return ë¶€ë¶„ì„ ì£¼ì„ì²˜ë¦¬í•˜ê³  ì•„ë˜ì™€ ê°™ì´ ë°”ê¿”ì„œ ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.

```ts

export async function getFileContent(options: {
...
...
...

    // return atob(file.content);

    // Decode using custom UTF-8 decoding function
    const content = decodeUTF8(file.content);

    return content;
}
```

ê·¸ë¦¬ê³  `github.server.ts` íŒŒì¼ì˜ ë§ˆì§€ë§‰ ë¶€ë¶„ì— ì•„ë˜ í•¨ìˆ˜ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

```ts
function decodeUTF8(base64: string): string {
        const binaryString = atob(base64);
        const bytes = new Uint8Array(binaryString.length);

        for (let i = 0; i < binaryString.length; i++) {
                bytes[i] = binaryString.charCodeAt(i);
        }

        // Use TextDecoder to handle UTF-8 decoding
        return new TextDecoder('utf-8').decode(bytes);
}
```

base64ë¡œ í•´ì‹±í•œ ë°ì´í„°ë¥¼ 'utf-8' ë””ì½”ë”©í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.

ì´ì œ ë‹¤ì‹œ í•´ë³¼ê¹Œìš”?

ê¼­ `.wrangler` í´ë” ë°‘ì— ìºì‹œëœ íŒŒì¼ì„ ì§€ìš°ê³  í…ŒìŠ¤íŠ¸ í•©ì‹œë‹¤.

```bash
npm run build & npm run start
```

